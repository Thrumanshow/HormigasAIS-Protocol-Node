name: ğŸœ HormigasAIS Node Health Check

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  health-check:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: ğŸ“¦ Install critical dependencies
        run: pip install fastapi uvicorn

      - name: ğŸ› ï¸ Build Sovereign Environment
        run: |
          mkdir -p logs contracts/config
          touch contracts/config/config.human # Simula contrato de autoridad

      - name: ğŸš€ Start Node & Validate Sovereignty
        run: |
          python3 -m uvicorn api.main:app --host 127.0.0.1 --port 8000 &
          sleep 5
          curl --fail http://127.0.0.1:8000/v1/health | grep '"status":"OPERATIONAL"'
          curl --fail http://127.0.0.1:8000/v1/health | grep '"sovereignty":"ENFORCED"'
